<html>
  <body>
    <div id="target"></div>
    <button id="button">Show some update</button>
    <iframe src="http://localhost:8078/iframe.html" style="display: none;"></iframe>

    <script>

        window.addEventListener('message', function(event) {
            const tagMapping = {
                'img': Document.prototype.createElement,
                'text': Document.prototype.createTextNode,
            }
            response = event.data;
            for (const update of response) {
                const element = tagMapping[update.type].call(document, update.value);
                for (const [key, value] of Object.entries(update.attributes))
                    element[key] = value;
                document.getElementById('target').appendChild(element);
            }
        });
        

        async function getUpdates() {
            document.getElementById('target').innerHTML = '';
            const domain = new URL(document.location.href).host;
            const iframe = document.getElementsByTagName('iframe')[0];
            await iframe.contentWindow.postMessage('getUpdates', "*");
        }

        document.getElementById('button').addEventListener('click', getUpdates);
    </script>
  </body>